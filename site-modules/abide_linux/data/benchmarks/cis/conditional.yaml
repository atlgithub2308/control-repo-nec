---
# Represents conditional modifications to the controls list
# If a control has children (i.e. other controls that depend on it)
# and you want to perform a conditional action on that control,
# you MUST put that control as an item in the approriate has with
# a children key that is an array of all child controls.
abide_linux::benchmarks::cis_centos_linux_7_benchmark::conditional:
  if:
    control:
      ensure_firewalld_is_installed:
        children:
          - ensure_iptablesservices_package_is_not_installed
          - ensure_nftables_is_not_installed_or_stopped_and_masked
          - ensure_firewalld_service_is_enabled_and_running
          - ensure_default_zone_is_set
          - ensure_network_interfaces_are_assigned_to_appropriate_zone
          - ensure_unnecessary_services_and_ports_are_not_accepted
        exclude:
          - ensure_nftables_is_installed
          - ensure_iptables_packages_are_installed
      ensure_nftables_is_installed:
        children:
          - ensure_firewalld_is_not_installed_or_stopped_and_masked
          - ensure_iptablesservices_package_is_not_installed
          - ensure_iptables_are_flushed
          - ensure_a_table_exists
          - ensure_base_chains_exist
          - ensure_loopback_traffic_is_configured
          - ensure_outbound_and_established_connections_are_configured
          - ensure_default_deny_firewall_policy
          - ensure_nftables_service_is_enabled
          - ensure_nftables_rules_are_permanent
        exclude:
          - ensure_firewalld_is_installed
          - ensure_iptables_packages_are_installed
      ensure_iptables_packages_are_installed:
        children:
          - ensure_nftables_is_not_installed
          - ensure_firewalld_is_not_installed_or_stopped_and_masked
          - ensure_default_deny_firewall_policy
          - ensure_loopback_traffic_is_configured
          - ensure_outbound_and_established_connections_are_configured
          - ensure_firewall_rules_exist_for_all_open_ports
          - ensure_iptables_rules_are_saved
          - ensure_iptables_is_enabled_and_running
          - ensure_ipv6_default_deny_firewall_policy
          - ensure_ipv6_loopback_traffic_is_configured
          - ensure_ipv6_outbound_and_established_connections_are_configured
          - ensure_ipv6_firewall_rules_exist_for_all_open_ports
          - ensure_ip6tables_rules_are_saved
          - ensure_ip6tables_is_enabled_and_running
        exclude:
          - ensure_firewalld_is_installed
          - ensure_nftables_is_installed

abide_linux::benchmarks::cis_red_hat_enterprise_linux_7_benchmark::conditional:
  if:
    control:
      ensure_firewalld_is_installed:
        children:
          - ensure_iptablesservices_package_is_not_installed
          - ensure_nftables_is_not_installed_or_stopped_and_masked
          - ensure_firewalld_service_is_enabled_and_running
          - ensure_default_zone_is_set
          - ensure_network_interfaces_are_assigned_to_appropriate_zone
          - ensure_unnecessary_services_and_ports_are_not_accepted
        exclude:
          - ensure_nftables_is_installed
          - ensure_iptables_packages_are_installed
      ensure_nftables_is_installed:
        children:
          - ensure_firewalld_is_not_installed_or_stopped_and_masked
          - ensure_iptablesservices_package_is_not_installed
          - ensure_iptables_are_flushed
          - ensure_a_table_exists
          - ensure_base_chains_exist
          - ensure_loopback_traffic_is_configured
          - ensure_outbound_and_established_connections_are_configured
          - ensure_default_deny_firewall_policy
          - ensure_nftables_service_is_enabled
          - ensure_nftables_rules_are_permanent
        exclude:
          - ensure_firewalld_is_installed
          - ensure_iptables_packages_are_installed
      ensure_iptables_packages_are_installed:
        children:
          - ensure_nftables_is_not_installed
          - ensure_firewalld_is_not_installed_or_stopped_and_masked
          - ensure_default_deny_firewall_policy
          - ensure_loopback_traffic_is_configured
          - ensure_outbound_and_established_connections_are_configured
          - ensure_firewall_rules_exist_for_all_open_ports
          - ensure_iptables_rules_are_saved
          - ensure_iptables_is_enabled_and_running
          - ensure_ipv6_default_deny_firewall_policy
          - ensure_ipv6_loopback_traffic_is_configured
          - ensure_ipv6_outbound_and_established_connections_are_configured
          - ensure_ipv6_firewall_rules_exist_for_all_open_ports
          - ensure_ip6tables_rules_are_saved
          - ensure_ip6tables_is_enabled_and_running
        exclude:
          - ensure_firewalld_is_installed
          - ensure_nftables_is_installed